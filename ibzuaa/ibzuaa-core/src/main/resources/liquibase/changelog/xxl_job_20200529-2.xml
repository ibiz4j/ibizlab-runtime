<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd">
    <changeSet author="Think (generated)" id="1590734259445-1">
        <createTable tableName="xxl_job_group">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="app_name" remarks="执行器AppName" type="VARCHAR(64)">
                <constraints nullable="false"/>
            </column>
            <column name="title" remarks="执行器名称" type="VARCHAR(12)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="order" remarks="排序" type="TINYINT(3)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="address_type" remarks="执行器地址类型：0=自动注册、1=手动录入" type="TINYINT(3)">
                <constraints nullable="false"/>
            </column>
            <column name="address_list" remarks="执行器地址列表，多地址逗号分隔" type="VARCHAR(512)"/>
        </createTable>
    </changeSet>
    <changeSet author="Think (generated)" id="1590734259445-2">
        <createTable tableName="xxl_job_info">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="job_group" remarks="执行器主键ID" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="job_cron" remarks="任务执行CRON" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="job_desc" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="add_time" type="datetime"/>
            <column name="update_time" type="datetime"/>
            <column name="author" remarks="作者" type="VARCHAR(64)"/>
            <column name="alarm_email" remarks="报警邮件" type="VARCHAR(255)"/>
            <column name="executor_route_strategy" remarks="执行器路由策略" type="VARCHAR(50)"/>
            <column name="executor_handler" remarks="执行器任务handler" type="VARCHAR(255)"/>
            <column name="executor_param" remarks="执行器任务参数" type="VARCHAR(512)"/>
            <column name="executor_block_strategy" remarks="阻塞处理策略" type="VARCHAR(50)"/>
            <column defaultValueNumeric="0" name="executor_timeout" remarks="任务执行超时时间，单位秒" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="executor_fail_retry_count" remarks="失败重试次数" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="glue_type" remarks="GLUE类型" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="glue_source" remarks="GLUE源代码" type="MEDIUMTEXT"/>
            <column name="glue_remark" remarks="GLUE备注" type="VARCHAR(128)"/>
            <column name="glue_updatetime" remarks="GLUE更新时间" type="datetime"/>
            <column name="child_jobid" remarks="子任务ID，多个逗号分隔" type="VARCHAR(255)"/>
            <column defaultValueNumeric="0" name="trigger_status" remarks="调度状态：0-停止，1-运行" type="TINYINT(3)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="trigger_last_time" remarks="上次调度时间" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column defaultValueNumeric="0" name="trigger_next_time" remarks="下次调度时间" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="Think (generated)" id="1590734259445-3">
        <createTable tableName="xxl_job_lock">
            <column name="lock_name" remarks="锁名称" type="VARCHAR(50)">
                <constraints primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="Think (generated)" id="1590734259445-4">
        <createTable tableName="xxl_job_log">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints primaryKey="true"/>
            </column>
            <column name="job_group" remarks="执行器主键ID" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="job_id" remarks="任务，主键ID" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="executor_address" remarks="执行器地址，本次执行的地址" type="VARCHAR(255)"/>
            <column name="executor_handler" remarks="执行器任务handler" type="VARCHAR(255)"/>
            <column name="executor_param" remarks="执行器任务参数" type="VARCHAR(512)"/>
            <column name="executor_sharding_param" remarks="执行器任务分片参数，格式如 1/2" type="VARCHAR(20)"/>
            <column defaultValueNumeric="0" name="executor_fail_retry_count" remarks="失败重试次数" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="trigger_time" remarks="调度-时间" type="datetime"/>
            <column name="trigger_code" remarks="调度-结果" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="trigger_msg" remarks="调度-日志" type="TEXT"/>
            <column name="handle_time" remarks="执行-时间" type="datetime"/>
            <column name="handle_code" remarks="执行-状态" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="handle_msg" remarks="执行-日志" type="TEXT"/>
            <column defaultValueNumeric="0" name="alarm_status" remarks="告警状态：0-默认、1-无需告警、2-告警成功、3-告警失败" type="TINYINT(3)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="Think (generated)" id="1590734259445-5">
        <createTable tableName="xxl_job_logglue">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="job_id" remarks="任务，主键ID" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="glue_type" remarks="GLUE类型" type="VARCHAR(50)"/>
            <column name="glue_source" remarks="GLUE源代码" type="MEDIUMTEXT"/>
            <column name="glue_remark" remarks="GLUE备注" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
            <column name="add_time" type="timestamp"/>
            <column name="update_time" type="timestamp"/>
        </createTable>
    </changeSet>
    <changeSet author="Think (generated)" id="1590734259445-6">
        <createTable tableName="xxl_job_registry">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="registry_group" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="registry_key" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="registry_value" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="update_time" type="timestamp">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="Think (generated)" id="1590734259445-7">
        <createTable tableName="xxl_job_user">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="username" remarks="账号" type="VARCHAR(50)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="password" remarks="密码" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="role" remarks="角色：0-普通用户、1-管理员" type="TINYINT(3)">
                <constraints nullable="false"/>
            </column>
            <column name="permission" remarks="权限：执行器ID列表，多个逗号分割" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

	<changeSet author="Think (generated)" id="1590734920859-1">
        <insert tableName="xxl_job_group">
            <column name="id" valueNumeric="1"/>
            <column name="app_name" value="xxl-job-executor-sample"/>
            <column name="title" value="示例执行器"/>
            <column name="order" valueNumeric="100"/>
            <column name="address_type" valueNumeric="0"/>
            <column name="address_list"/>
        </insert>
	</changeSet>
	
	<changeSet author="Think (generated)" id="1590734920859-2">
        <insert tableName="xxl_job_info">
            <column name="id" valueNumeric="1"/>
            <column name="job_group" valueNumeric="1"/>
            <column name="job_cron" value="0 * * * * ? *"/>
            <column name="job_desc" value="测试任务1"/>
            <column name="add_time" valueDate="2018-11-04T06:21:31"/>
            <column name="update_time" valueDate="2019-10-23T20:40:17"/>
            <column name="author" value="XXL"/>
            <column name="alarm_email" value=""/>
            <column name="executor_route_strategy" value="FIRST"/>
            <column name="executor_handler" value="demoJobHandler"/>
            <column name="executor_param" value=""/>
            <column name="executor_block_strategy" value="SERIAL_EXECUTION"/>
            <column name="executor_timeout" valueNumeric="0"/>
            <column name="executor_fail_retry_count" valueNumeric="0"/>
            <column name="glue_type" value="BEAN"/>
            <column name="glue_source" value=""/>
            <column name="glue_remark" value="GLUE代码初始化"/>
            <column name="glue_updatetime" valueDate="2018-11-04T06:21:31"/>
            <column name="child_jobid" value=""/>
            <column name="trigger_status" valueNumeric="0"/>
            <column name="trigger_last_time" valueNumeric="0"/>
            <column name="trigger_next_time" valueNumeric="0"/>
        </insert>
	</changeSet>
	
	<changeSet author="Think (generated)" id="1590734920859-6">
        <insert tableName="xxl_job_user">
            <column name="id" valueNumeric="2"/>
            <column name="username" value="ibzadmin"/>
            <column name="password" value="e10adc3949ba59abbe56e057f20f883e"/>
            <column name="role" valueNumeric="1"/>
            <column name="permission" value=""/>
        </insert>
	</changeSet>
	
	<changeSet author="Think (generated)" id="1590734920859-3">
        <insert tableName="xxl_job_lock">
            <column name="lock_name" value="schedule_lock"/>
        </insert>
    </changeSet>
	
</databaseChangeLog>
